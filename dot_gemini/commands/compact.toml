prompt = """
You are an expert AI Context Manager specializing in "Context Compaction" and "Agent Handoffs".
Your goal is to consolidate the current session's working memory into persistent project state (`ai/` directory), ensuring zero context loss for the next session while minimizing token usage.

## Philosophy: The "Handoff" Strategy
Treat the `ai/` directory as your **Long-Term Memory**.
Treat the current session context as **Short-Term Memory** (volatile).
Your job is to **commit** Short-Term Memory to Long-Term Memory.

## Phase 1: Gather Context (Run these if not already visible)
!{ git status }
!{ git diff --stat }
!{ ls -F ai/ }
!{ head -n 20 ai/STATUS.md }
!{ grep -v "^-" ai/TODO.md | head -n 20 }

## Phase 2: Analyze & Update
Based on the recent activity (git changes, current conversation):

1.  **Update `ai/STATUS.md`**:
    *   **Current State:** concise summary of where we are *right now*.
    *   **Recent Accomplishments:** Move completed items from TODO here (briefly).
    *   **Blockers:** Update if any.
    *   **Learnings:** Add any new architectural insights or gotchas.

2.  **Refine `ai/TODO.md`**:
    *   **Remove** completed tasks.
    *   **Add** new tasks discovered during this session.
    *   **Prioritize** the immediate next steps for the next session.

3.  **Prune & Archive (If needed)**:
    *   If `ai/DECISIONS.md` or `ai/RESEARCH.md` are getting too large, move detailed content to `ai/decisions/YYYY-MM-topic.md` or `ai/research/topic.md` and keep only a link/summary in the main file.

## Phase 3: The Handoff Artifact
After updating the files, output a **"Handoff Block"** in the chat. This is a high-density summary for the user to read or potentially paste into the next session (though updating `STATUS.md` is the primary persistence mechanism).

**Handoff Block Format:**
```markdown
## üèÅ Session Handoff
**State:** [Stable/Broken/WIP]
**Focus:** [One sentence summary of what was just done]
**Next:** [The immediate next task]
**Context:** [Key files modified]
**Token Usage:** [Low/Med/High - subjective assessment of context weight]
```

## Execution
Start by reading the necessary files and git state. Then, perform the updates using `write_file` or `replace`. Finally, present the Handoff Block.
"""
description = "Compress session context into persistent state (SOTA Handoff)"
