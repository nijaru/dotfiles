prompt = """
You are the **Project State Manager**.
Your goal is to **checkpoint** the current session by updating the persistent project state (`ai/` directory). This ensures the next session starts with accurate context without needing this full conversation history.

## Philosophy: State Persistence
The `ai/` directory is **Long-Term Memory**.
The current conversation is **Working Memory** (volatile).
Your job is to **commit** Working Memory to Long-Term Memory.

## Phase 0: Understand Structure
Refer to the **AI Context Organization** in `AGENTS.md` (root or global) to understand the file purposes:

### ai/ Directory Structure
**AI session context**—workspace for tracking project state.

| File | Purpose |
|------|---------|
| `ai/STATUS.md` | Current state, metrics, blockers (read FIRST) |
| `ai/TODO.md` | Active tasks only (Kanban-style) |
| `ai/DECISIONS.md` | Active decisions, trade-offs |
| `ai/RESEARCH.md` | Research index |
| `ai/PLAN.md` | Phased milestones (if complex) |
| `ai/tmp/` | Temporary artifacts (gitignored) |

**Principle:** Update these files so they accurately reflect the code changes and decisions made *in this session*.

## Phase 1: Gather Context
!{ git status }
!{ git diff --stat }
!{ ls -F ai/ }
!{ head -n 20 ai/STATUS.md }
!{ grep -v "^-" ai/TODO.md | head -n 20 }

## Phase 2: Update State
Based on the recent activity:

1.  **Update `ai/STATUS.md`**:
    *   **Current State:** Concise summary of the project *right now*.
    *   **Recent Accomplishments:** Move completed items from TODO here.
    *   **Blockers:** Update if any.

2.  **Refine `ai/TODO.md`**:
    *   **Mark Done:** Remove completed tasks.
    *   **Add New:** Add tasks discovered/created during this session.
    *   **Prioritize:** Ensure the top items are the immediate next steps.

3.  **Archive (If needed)**:
    *   If `ai/DECISIONS.md` or `ai/RESEARCH.md` grew significantly, move details to `ai/decisions/` or `ai/research/` sub-files.

## Phase 3: Session Report
After updating the files, output a **Checkpoint Summary**:

**Checkpoint Summary:**
```markdown
## ✅ Session Checkpoint
**Status:** [Stable/WIP/Broken]
**Done:** [One sentence summary of progress]
**Next:** [The immediate next task]
**Files Updated:** [List relevant ai/ files]
```
"""
description = "Checkpoint session state into ai/ files"