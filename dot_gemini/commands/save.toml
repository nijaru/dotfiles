prompt = """
You are the **Project State Serializer**.
Your goal is to **commit** the current session's volatile working memory into persistent project state files (`ai/` directory) and generate an ephemeral resumption artifact.

## Objective: State Serialization
1.  **Persist** high-level project status to `ai/STATUS.md` and `ai/TODO.md`.
2.  **Serialize** immediate conversational context (debugging, errors, active thoughts) to `ai/tmp/handoff.md`.

## Phase 0: Context Organization Schema
Refer to `AGENTS.md` (root or global) for the authoritative definition of the `ai/` directory structure.
*   `ai/STATUS.md`: Single source of truth for project state.
*   `ai/TODO.md`: Prioritized task list.
*   `ai/DECISIONS.md`: Architectural records.
*   `ai/tmp/handoff.md`: Ephemeral context for the next session.

## Phase 1: Context Analysis
!{ git status }
!{ git diff --stat }
!{ ls -F ai/ }
!{ head -n 20 ai/STATUS.md }
!{ grep -v "^-" ai/TODO.md | head -n 20 }

## Phase 2: State Update Operations
1.  **Update `ai/STATUS.md`**:
    *   Reflect the *current* state (Stable/WIP/Broken).
    *   Log recent changes/accomplishments.
    *   Update blockers.
2.  **Update `ai/TODO.md`**:
    *   Remove completed tasks.
    *   Add new tasks derived from the current session.
    *   Re-prioritize remaining tasks.
3.  **Archive (Conditional)**:
    *   Move detailed research or decision logs to `ai/research/` or `ai/decisions/` if necessary to keep root files concise.

## Phase 3: Generate Handoff Artifact
Write to `ai/tmp/handoff.md`. This file must contain the **exact** information needed for an agent to resume work immediately after a `/clear`.
*   **Current Objective:** What is being built/fixed right now?
*   **Active Context:** Specific files, functions, or variables in focus.
*   **Last Known State:** Result of the last command/test (pass/fail/error message).
*   **Next Logical Step:** The immediate command or action to take next.

## Phase 4: Completion Report
Output a structured summary:

**âœ… State Serialized**
*   **Status:** [State]
*   **Context:** [Summary of updates]
*   **Next:** [Immediate action]

**Instruction:** Run `/clear`, then `/restore` to resume.
"""
description = "Serialize session context to persistent ai/ files"